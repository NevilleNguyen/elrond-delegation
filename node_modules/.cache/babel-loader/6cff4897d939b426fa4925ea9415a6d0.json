{"ast":null,"code":"import _regeneratorRuntime from\"/Users/neville/Documents/Github/elrond-delegation/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/neville/Documents/Github/elrond-delegation/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from'react';import{Formik}from'formik';import{object,array,mixed}from'yup';import{Submit}from'components/Action';import{useAction}from'components/Action/context';import{Dropzone}from'components/Nodes/components/Dropzone';import useTransaction from'helpers/useTransaction';import styles from'./styles.module.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Add=function Add(){var _useTransaction=useTransaction(),sendTransaction=_useTransaction.sendTransaction;var _useAction=useAction(),setShowModal=_useAction.setShowModal;var validationSchema=object().shape({files:array().of(mixed()).required('PEM file is required.').test('validKeyLength','Invalid PEM file.',function(value){return value.every(function(file){return file.errors&&!file.errors.includes('length');});}).test('keyIsUnused','Key exists already.',function(value){return value.every(function(file){return file.errors&&!file.errors.includes('existing');});}).test('keyIsUnique','Duplicate key detected!',function(value){return value.every(function(file){return file.errors&&!file.errors.includes('unique');});})});var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(_ref){var files,value;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:files=_ref.files;_context.prev=1;value=files.reduce(function(total,current){return\"\".concat(total,\"@\").concat(current.pubKey,\"@\").concat(current.signature);},'');if(!Boolean(value)){_context.next=7;break;}_context.next=6;return sendTransaction({args:value,type:'addNodes',value:'0'});case 6:setTimeout(function(){return setShowModal(false);},250);case 7:_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);console.error(_context.t0);case 12:case\"end\":return _context.stop();}},_callee,null,[[1,9]]);}));return function onSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Formik,{initialValues:{files:[]},onSubmit:onSubmit,validationSchema:validationSchema,children:function children(_ref3){var handleSubmit=_ref3.handleSubmit,errors=_ref3.errors;return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"\".concat(styles.add,\" add\"),children:[/*#__PURE__*/_jsx(Dropzone,{}),errors.files&&/*#__PURE__*/_jsx(\"div\",{className:styles.error,children:errors.files}),/*#__PURE__*/_jsx(Submit,{close:\"Cancel\",submit:\"Save\"})]});}});};","map":{"version":3,"names":["React","Formik","object","array","mixed","Submit","useAction","Dropzone","useTransaction","styles","jsx","_jsx","jsxs","_jsxs","Add","_useTransaction","sendTransaction","_useAction","setShowModal","validationSchema","shape","files","of","required","test","value","every","file","errors","includes","onSubmit","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_ref","wrap","_callee$","_context","prev","next","reduce","total","current","concat","pubKey","signature","Boolean","args","type","setTimeout","t0","console","error","stop","_x","apply","arguments","initialValues","children","_ref3","handleSubmit","className","add","close","submit"],"sources":["/Users/neville/Documents/Github/elrond-delegation/src/components/Nodes/components/Add/Add.tsx"],"sourcesContent":["import React from 'react';\n\nimport { Formik } from 'formik';\nimport { object, array, mixed } from 'yup';\n\nimport { Submit } from 'components/Action';\n\nimport { useAction } from 'components/Action/context';\nimport {\n  Dropzone,\n  DropzonePayloadType,\n  DropzoneFormType\n} from 'components/Nodes/components/Dropzone';\nimport useTransaction from 'helpers/useTransaction';\n\nimport styles from './styles.module.scss';\n\nexport const Add = () => {\n  const { sendTransaction } = useTransaction();\n  const { setShowModal } = useAction();\n\n  const validationSchema = object().shape({\n    files: array()\n      .of(mixed())\n      .required('PEM file is required.')\n      .test('validKeyLength', 'Invalid PEM file.', (value: any) =>\n        value.every(\n          (file: DropzonePayloadType) =>\n            file.errors && !file.errors.includes('length')\n        )\n      )\n      .test('keyIsUnused', 'Key exists already.', (value: any) =>\n        value.every(\n          (file: DropzonePayloadType) =>\n            file.errors && !file.errors.includes('existing')\n        )\n      )\n      .test('keyIsUnique', 'Duplicate key detected!', (value: any) =>\n        value.every(\n          (file: DropzonePayloadType) =>\n            file.errors && !file.errors.includes('unique')\n        )\n      )\n  });\n\n  const onSubmit = async ({ files }: DropzoneFormType): Promise<void> => {\n    try {\n      const value = files.reduce(\n        (total: string, current: DropzonePayloadType) =>\n          `${total}@${current.pubKey}@${current.signature}`,\n        ''\n      );\n\n      if (Boolean(value)) {\n        await sendTransaction({\n          args: value,\n          type: 'addNodes',\n          value: '0'\n        });\n\n        setTimeout(() => setShowModal(false), 250);\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  return (\n    <Formik\n      initialValues={{ files: [] }}\n      onSubmit={onSubmit}\n      validationSchema={validationSchema}\n    >\n      {({ handleSubmit, errors }) => (\n        <form onSubmit={handleSubmit} className={`${styles.add} add`}>\n          <Dropzone />\n\n          {errors.files && <div className={styles.error}>{errors.files}</div>}\n\n          <Submit close='Cancel' submit='Save' />\n        </form>\n      )}\n    </Formik>\n  );\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}