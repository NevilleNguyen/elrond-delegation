import{a as x}from"./chunk-YTYNUTPN.js";import{a as X}from"./chunk-QRPURFAS.js";import{a as Q}from"./chunk-KG4M4ACY.js";import{a as I}from"./chunk-KVVBB443.js";import{a as K}from"./chunk-XNZGF3PO.js";import{a as z,d as J}from"./chunk-QFKT22AW.js";import{e as _}from"./chunk-3AWBGP7M.js";import{c as q,d as l}from"./chunk-G3PZHPKZ.js";import{b as B,d as F,e as N,f as G,g as $}from"./chunk-7RNOZDML.js";import{a as me}from"./chunk-OUEPJKUR.js";import{a as ve}from"./chunk-6AWYFPQL.js";import{a as M}from"./chunk-CSUZ4NMB.js";import{c as b}from"./chunk-3LKAAPJM.js";import{b as O,c as fe}from"./chunk-EC436OTI.js";import{o as pe}from"./chunk-K2GW23ZC.js";import{j as a,m as H}from"./chunk-HBP5N4FR.js";H();import{useRef as S,useState as v,useEffect as Le}from"react";fe();me();pe();ve();var we=(e=>(e.invalidAddress="Invalid address",e.invalidConfig="Invalid WalletConnect setup",e.invalidTopic="Expired connection",e.sessionExpired="Unable to connect to existing session",e.connectError="Unable to connect",e.userRejected="User rejected connection proposal",e.userRejectedExisting="User rejected existing connection proposal",e.errorLogout="Unable to remove existing pairing",e))(we||{}),Fe=({callbackRoute:u,logoutRoute:V,token:m,nativeAuth:W,onLoginRedirect:Y})=>{let U=q(),k=W!=null,g=K(W),e=m,[A,c]=v(""),[d,Z]=v(""),[R,L]=v(!0),[ee,w]=v([]),C=J(),p=l(F),f=l(N),ne=l(G),te=l(B),oe=l($),i=S(C),y=S(!0),h=S(!1),D=["mvx_cancelAction"],re=R?"":`${oe}?wallet-connect=${encodeURIComponent(d)}`;x(()=>{!m||j()},[m]),x(()=>{i.current=C},[C]),Le(()=>{L(!Boolean(d))},[d]);let ie=()=>{X(V)},ce=n=>{console.log("WalletConnect Session Event: ",n)},se=()=>{y.current=!1};function ae(){return a(this,null,function*(){var n;try{let t=i.current;if(I()||t==null||!Q("walletconnectv2"))return;if(!y.current){try{yield(n=i.current)==null?void 0:n.logout()}catch(Ce){console.warn("Unable to logout")}return}let r=yield t.getAddress();if(!r){console.warn("Login cancelled.");return}let s=yield t.getSignature(),T={address:r,loginMethod:"walletconnectv2"},de={logoutRoute:V,loginType:"walletconnectv2",callbackRoute:u!=null?u:window==null?void 0:window.location.href};U(b(de)),s&&g.setTokenLoginInfo({signature:s,address:r}),U(O(T)),M({callbackRoute:u,onLoginRedirect:Y,options:{address:r,signature:s}})}catch(t){c("Invalid address"),console.error(t)}})}function E(n=!0){return a(this,null,function*(){if(!f||!p){c("Invalid WalletConnect setup");return}if(h.current)return;let t={onClientLogin:ae,onClientLogout:ie,onClientEvent:ce};h.current=!0;let o=new _(t,te,p,f,ne);yield o.init(),h.current=!1,y.current=!0,z(o),w(o.pairings),i.current=o,n&&j()})}function le(n){return a(this,null,function*(){var t,o,r;if(!p||!f){c("Invalid WalletConnect setup");return}if(!n||!n.topic){c("Expired connection");return}try{let{approval:s}=yield(t=i.current)==null?void 0:t.connect({topic:n.topic,methods:D});if(k&&!e&&(e=yield g.getNativeAuthLoginToken(),!e)){console.warn("Fetching block failed. Login cancelled.");return}e&&g.setLoginToken(e);try{yield(o=i.current)==null?void 0:o.login({approval:s,token:e})}catch(T){c("User rejected existing connection proposal"),L(!0),yield E()}}catch(s){console.error("Unable to connect to existing session",s),c("Unable to connect to existing session")}finally{w((r=i.current)==null?void 0:r.pairings)}})}function ge(n){return a(this,null,function*(){var t,o;try{n&&(yield(t=i.current)==null?void 0:t.logout({topic:n}))}catch(r){console.error("Unable to remove existing pairing",r),c("Unable to remove existing pairing")}finally{let r=yield(o=i.current)==null?void 0:o.getPairings();w(r)}})}function j(){return a(this,null,function*(){var n,t;if(!p||!f){c("Invalid WalletConnect setup");return}try{let{uri:o,approval:r}=yield(n=i.current)==null?void 0:n.connect({methods:D});if(!Boolean(o))return;if(Z(o),k&&!e&&(e=yield g.getNativeAuthLoginToken(),!e)){console.warn("Fetching block failed. Login cancelled.");return}e&&g.setLoginToken(e);try{yield(t=i.current)==null?void 0:t.login({approval:r,token:e})}catch(T){c("User rejected connection proposal"),L(!0),yield E()}}catch(o){console.error("Unable to connect",o)}})}let P=Boolean(A),ue=I();return[E,{error:A,loginFailed:P,isLoading:R&&!P,isLoggedIn:ue&&!P},{uriDeepLink:re,walletConnectUri:d,cancelLogin:se,connectExisting:le,removeExistingPairing:ge,wcPairings:ee}]};export{we as a,Fe as b};
//# sourceMappingURL=chunk-M263BCY6.js.map
