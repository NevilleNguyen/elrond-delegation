import{a as B}from"./chunk-42RJQAFV.js";import{a as $}from"./chunk-G3XJ7574.js";import{a as j}from"./chunk-VYKIRYQG.js";import{a as z}from"./chunk-I2NVMWNR.js";import{a as V}from"./chunk-SADC2JUH.js";import{b as x}from"./chunk-5V4KCOPF.js";import{c as L,d as U}from"./chunk-G3PZHPKZ.js";import{f as D}from"./chunk-EV2NV6KZ.js";import{a as k}from"./chunk-BS736HVP.js";import{a as G}from"./chunk-X5TGO2UY.js";import{a as cn}from"./chunk-OUEPJKUR.js";import{c as _}from"./chunk-BKQNVPXF.js";import{h as b}from"./chunk-QM237XII.js";import{e as W,j as O,k as T}from"./chunk-2AOPQAPV.js";import{l as P,t as an}from"./chunk-HAVQLHXJ.js";import{a as y}from"./chunk-MV7THB7B.js";import{a as N,c as g,d as M,e as v,f as w}from"./chunk-QR72MI4M.js";import{o as rn}from"./chunk-K2GW23ZC.js";import{j as S,m as C}from"./chunk-HBP5N4FR.js";C();an();import{useEffect as ln,useRef as F}from"react";import{ExtensionProvider as X}from"@multiversx/sdk-extension-provider";cn();rn();var _n=()=>{let c=L(),I=F("/"),{provider:r}=V(),p=x(r),u=F(!1),Z=j(),q=U(D),{transactionsToSign:e,error:H,setError:J,hasTransactions:m,onAbort:E,clearTransactionStatusMessage:h}=B();$(E);function K(n){var t,s;let a=r instanceof X;c(W()),c(b(n)),c(_(y)),u.current=!1,a&&(h(),(s=(t=X.getInstance())==null?void 0:t.cancelAction)==null||s.call(t))}let f=(n,a)=>{p==="walletconnectv2"&&(n=g);let s=n.includes(g);if(K(a),s){c(O(g));return}J(n)},Q=(n,a,t="")=>{let s={[P]:a},d=window!=null&&window.location?`${window.location.origin}${t}`:`${t}`,i=G({callbackUrl:d,urlParams:s});r.signTransactions(n,{callbackUrl:encodeURIComponent(i)})},Y=()=>S(void 0,null,function*(){var R;if(u.current||!e)return;let{sessionId:n,transactions:a,callbackRoute:t,customTransactionInformation:s}=e,{redirectAfterSign:d}=s,i=t||(window==null?void 0:window.location.pathname),sn=window==null?void 0:window.location.pathname.includes(i),tn=d&&!sn;try{if(!(yield(R=r==null?void 0:r.init)==null?void 0:R.call(r)))return}catch(o){let l=(o==null?void 0:o.message)||o||v;console.error(l),f(l);return}try{u.current=!0;let o=yield r.signTransactions(a);if(u.current=!1,!z(o))return;let on=Object.values(o).map(en=>k(en)),A={sessionId:n,transactions:on,status:"signed"};tn&&(A.redirectRoute=i),c(T(A))}catch(o){u.current=!1;let l=(o==null?void 0:o.message)||o||M;console.error(l),c(T({sessionId:n,status:"cancelled"})),f(l.includes("cancel")?g:l,n)}}),nn=()=>S(void 0,null,function*(){if(!e)return;h();let{sessionId:n,transactions:a,callbackRoute:t}=e;if(!r){console.error(w);return}I.current=t||(window==null?void 0:window.location.pathname);try{let s=p==="wallet",d=yield Z(a);if(s)return Q(d,n,t);Y()}catch(s){let i=(s==null?void 0:s.message)||N;console.error(i),f(i,n),c(T({sessionId:n,status:"cancelled"})),console.error(i,s)}});return ln(()=>{m?nn():u.current=!1},[e,m]),{error:H,canceledTransactionsMessage:q,onAbort:E,hasTransactions:m,callbackRoute:I.current,sessionId:e==null?void 0:e.sessionId,transactions:e==null?void 0:e.transactions}};export{_n as a};
//# sourceMappingURL=chunk-5RD6HM3T.js.map
