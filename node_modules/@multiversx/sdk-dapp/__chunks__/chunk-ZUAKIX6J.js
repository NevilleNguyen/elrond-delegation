import{a as q}from"./chunk-5WQI3F3M.js";import{a as j}from"./chunk-KVVBB443.js";import{a as V}from"./chunk-XNZGF3PO.js";import{a as v}from"./chunk-QFKT22AW.js";import{d as B}from"./chunk-5V4KCOPF.js";import{c as $,d as X}from"./chunk-G3PZHPKZ.js";import{g as _}from"./chunk-JLY4442Z.js";import{a as Le}from"./chunk-OUEPJKUR.js";import{a as pe}from"./chunk-6AWYFPQL.js";import{a as T}from"./chunk-CSUZ4NMB.js";import{g as A,h as U}from"./chunk-LHCY2HW6.js";import{d as W}from"./chunk-3LKAAPJM.js";import{b as h,c as ue}from"./chunk-EC436OTI.js";import{a as l}from"./chunk-J42ZO72F.js";import{h as R,i as fe}from"./chunk-QR72MI4M.js";import{o as ge}from"./chunk-K2GW23ZC.js";import{a as G,b as N,j as c,k as O,m as F}from"./chunk-HBP5N4FR.js";F();fe();import{useEffect as me,useState as J}from"react";import{HWProvider as x}from"@multiversx/sdk-hw-provider";ue();Le();ge();pe();var d="Check if the MultiversX App is open on Ledger";function De({callbackRoute:S,token:K,addressesPerPage:f,nativeAuth:E,onLoginRedirect:I}){let P=X(_),s=$(),k=j(),Q=E!=null,u=V(E),a=K,{accounts:g,setAccounts:Y,isLoading:Z,setIsLoading:n,setShowAddressList:p,showAddressList:ee,startIndex:L,selectedAddress:r,onGoToPrevPage:oe,onGoToNextPage:te,onSelectAddress:ne,error:b,setError:i,defaultAddressesPerPage:re}=q(),ie=f!=null?f:re,m=new x,[C,se]=J(""),[H,ae]=J(!1);function M({provider:e,address:o,index:t,signature:y}){v(e),s(W({index:t,loginType:"ledger"})),y&&u.setTokenLoginInfo({signature:y,address:o}),s(h({address:o,loginMethod:"ledger"})),T({callbackRoute:S,onLoginRedirect:I,options:{address:o,signature:y}})}let z=(e,o="")=>{let{errorMessage:t}=l(e);t&&i(`${t}.${o}`),n(!1),console.warn(e),s(A(null))};function de(e){return c(this,null,function*(){if(r==null)return!1;let{index:o}=r;if(Q&&!a&&(a=yield u.getNativeAuthLoginToken(),!a)){console.warn("Fetching block failed. Login cancelled.");return}if(a){u.setLoginToken(a);try{let t=yield e.tokenLogin({token:O.Buffer.from(`${a}{}`),addressIndex:o});M({address:t.address,provider:e,index:o,signature:t.signature.hex()})}catch(t){z(t,". Update MultiversX App to continue.")}}else try{let t=yield e.login({addressIndex:o});M({address:t,provider:e,index:o})}catch(t){return z(t),!1}return!0})}function ce(){return c(this,null,function*(){try{if(n(!0),r==null)return!1;s(P?U(r):A(N(G({},r),{version:C,hasContractDataEnabled:H})));let e=new x;if(!(yield e.init()))return i(d),console.warn(d),!1;n(!1),yield de(e)}catch(e){let{errorMessage:o}=l(e);o&&i(o),console.warn(d,e)}finally{n(!1)}return p(!1),!0})}function D(){return c(this,null,function*(){try{if(n(!0),!(yield m.init())){i(d),console.warn(d),n(!1);return}let o=yield m.getAccounts(L,ie),t=yield B(m);se(t.version),ae(t.dataEnabled),Y(o),n(!1)}catch(e){let{errorMessage:o,defaultErrorMessage:t}=l(e);i(o!=null?o:t),console.error("error",e),n(!1)}})}function le(){return c(this,null,function*(){if(k)throw new Error(R);i("");try{if(n(!0),P!=null){let e=new x;if(!(yield e.init())||!r){console.warn(d);return}let t=yield e.login({addressIndex:r.index.valueOf()});if(v(e),!t){n(!1),console.warn("Login cancelled.");return}s(h({address:t,loginMethod:"ledger"})),T({callbackRoute:S,onLoginRedirect:I})}else(g==null?void 0:g.length)>0||(yield D()),p(!0)}catch(e){console.error("error ",e);let{defaultErrorMessage:o}=l();i(o)}finally{n(!1)}})}me(()=>{D()},[L]);let w=Boolean(b);return[le,{loginFailed:w,isLoggedIn:k&&!w,error:b,isLoading:Z&&!w},{accounts:g,showAddressList:ee,startIndex:L,selectedAddress:r,version:C,contractDataEnabled:H,onGoToPrevPage:oe,onGoToNextPage:te,onSelectAddress:ne,onConfirmSelectedAddress:ce}]}export{De as a};
//# sourceMappingURL=chunk-ZUAKIX6J.js.map
