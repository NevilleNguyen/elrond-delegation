import{a as h}from"./chunk-YTYNUTPN.js";import{a as R}from"./chunk-QRPURFAS.js";import{a as y}from"./chunk-KG4M4ACY.js";import{a as I}from"./chunk-KVVBB443.js";import{a as F}from"./chunk-XNZGF3PO.js";import{a as N}from"./chunk-SADC2JUH.js";import{a as $}from"./chunk-QFKT22AW.js";import{d as O}from"./chunk-3AWBGP7M.js";import{c as G,d as v}from"./chunk-G3PZHPKZ.js";import{c as E,g as M}from"./chunk-7RNOZDML.js";import{a as ce}from"./chunk-OUEPJKUR.js";import{a as ie}from"./chunk-6AWYFPQL.js";import{a as B}from"./chunk-CSUZ4NMB.js";import{c as x}from"./chunk-3LKAAPJM.js";import{b,c as re}from"./chunk-EC436OTI.js";import{o as oe}from"./chunk-K2GW23ZC.js";import{j as s,m as H}from"./chunk-HBP5N4FR.js";H();import{useEffect as ae,useRef as q,useState as z}from"react";re();ce();oe();ie();var Se=({logoutRoute:T,callbackRoute:l,nativeAuth:W,token:d,onLoginRedirect:J})=>{let U=G(),j=15e3,K=W!=null,p=F(W),c=d,[k,Q]=z(""),[g,P]=z(""),{provider:a}=N(),f=v(E),V=v(M),o=q(a),m=q(!0),L,S=Boolean(g),X=!S,Y=S?`${V}?wallet-connect=${encodeURIComponent(g)}`:"";ae(()=>{A();let t=setInterval(()=>{A()},j);return()=>clearInterval(t)},[a]),h(()=>{!d||D()},[d]),h(()=>{o.current=a},[a]);let w=()=>{R(T)},Z=()=>{m.current=!1};function A(){return s(this,null,function*(){var i,e;if(a==null||!y("walletconnect")||!Boolean((e=(i=o.current)==null?void 0:i.walletConnector)==null?void 0:e.connected))return;let n={method:"heartbeat",params:{}};try{yield o.current.sendCustomMessage(n)}catch(r){console.error("Connection lost",r),w()}})}function _(){return s(this,null,function*(){var t;try{let n=o.current;if(I()||n==null||!y("walletconnect"))return;if(!m.current){try{yield(t=o.current)==null?void 0:t.logout()}catch(se){console.warn("Unable to logout")}return}let e=yield n.getAddress();if(!e){console.warn("Login cancelled.");return}let r=yield n.getSignature(),u={address:e,loginMethod:"walletconnect"},ne={logoutRoute:T,loginType:"walletConnect",callbackRoute:l!=null?l:window==null?void 0:window.location.href};U(x(ne)),r&&p.setTokenLoginInfo({signature:r,address:e}),U(b(u)),n.walletConnector.on("heartbeat",()=>{clearInterval(L),L=setInterval(()=>{console.log("xPortal Mobile Wallet Connection Lost"),w(),clearInterval(L)},15e4)}),B({callbackRoute:l,onLoginRedirect:J,options:{address:e,signature:r}})}catch(n){Q("Invalid address"),console.error(n)}})}function ee(t=!0){return s(this,null,function*(){var r,u;let n=t&&!g;if(!f||((u=(r=o==null?void 0:o.current)==null?void 0:r.isInitialized)==null?void 0:u.call(r))&&!n)return;let i={onClientLogin:_,onClientLogout:w},e=new O(f,i);yield e.init(),m.current=!0,$(e),o.current=e,t&&D()})}function D(){return s(this,null,function*(){var e;if(!f)return;let t=yield(e=o.current)==null?void 0:e.login();if(!Boolean(t))return;if(K&&!c&&(c=yield p.getNativeAuthLoginToken(),!c)){console.warn("Fetching block failed. Login cancelled.");return}if(!c){P(t);return}p.setLoginToken(c);let i=`${t}&token=${c}`;P(i)})}let C=Boolean(k),te=I();return[ee,{error:k,loginFailed:C,isLoading:X&&!C,isLoggedIn:te&&!C},{uriDeepLink:Y,walletConnectUri:g,cancelLogin:Z}]};export{Se as a};
//# sourceMappingURL=chunk-QY7CJB4G.js.map
