import{a as D}from"./chunk-5GQHZUMU.js";import{a as v}from"./chunk-WISK7MIJ.js";import{a as N}from"./chunk-XHF4XEBJ.js";import{a as U}from"./chunk-SADC2JUH.js";import{c as T,d as p}from"./chunk-G3PZHPKZ.js";import{a as R,e as C}from"./chunk-JF2LFW3V.js";import{a as Q}from"./chunk-OUEPJKUR.js";import{b as c,c as k,d as h}from"./chunk-VL7EOLJA.js";import{t as H}from"./chunk-HAVQLHXJ.js";import{a as M,b as g,e as I}from"./chunk-QR72MI4M.js";import{a as F}from"./chunk-4Z6EY67I.js";import{a as b}from"./chunk-OGKM4YOJ.js";import{a as S,b as m,j as f,m as w}from"./chunk-HBP5N4FR.js";w();H();import{useEffect as y,useState as V}from"react";Q();F();var ls=()=>{let t=T(),[r,l]=V(""),d=p(R).signedSessions[r],{isPending:E,errorMessage:L}=D(),P=window==null?void 0:window.location.search,{provider:a,providerType:x}=U(),u=x==="wallet",A=p(C),G=()=>{t(k())},o=({callbackRoute:e,errorMessage:n=g})=>{let s=n.includes(g),i=Date.now().toString();d||l(i),t(c({errorMessage:n,sessionId:i,signedSession:{callbackUrl:e,status:s?"cancelled":"failed"}}))},O=(e,n)=>{if(!e)return"";let s=new URL(e);return s.searchParams.get("sessionId")||s.searchParams.append("sessionId",n),`${u?window==null?void 0:window.location.origin:""}${s.pathname}${s.search}`},W=()=>f(void 0,null,function*(){var e;if(!u)try{if(!(yield(e=a==null?void 0:a.init)==null?void 0:e.call(a)))throw Error(I)}catch(n){let s=(n==null?void 0:n.message)||n||I;throw Error(s)}}),z=e=>a.signMessage(e.message,{callbackUrl:encodeURIComponent(String(e.callbackRoute))}),_=e=>f(void 0,null,function*(){let n=Date.now().toString();l(n);let s=O(e.callbackRoute,n);if(t(c({sessionId:n,signedSession:{status:"pending",message:e.message,callbackUrl:s}})),u)return z(m(S({},e),{callbackRoute:s}));try{yield W()}catch(i){return o({errorMessage:String(i),callbackRoute:s})}try{let i=yield N(m(S({},e),{callbackRoute:s}));return i.signature?t(c({sessionId:n,signedSession:{status:"signed",callbackUrl:s,message:e.message,signature:i.signature.hex()}})):o({errorMessage:g,callbackRoute:s})}catch(i){let j=(i==null?void 0:i.message)||i||M;return o({errorMessage:j,callbackRoute:s})}}),$=()=>{if(P){let{remainingParams:{signature:e,sessionId:n,status:s},clearNavigationHistory:i}=v(Object.values(b));if(!n)return;if(l(n),["cancelled","failed"].includes(s))return o({errorMessage:s==="cancelled"?g:M});if(e&&s==="signed")return t(c({sessionId:r,signedSession:{signature:e,status:s}}));i()}};return y(()=>{$()},[P]),y(()=>{(E||L)&&!d&&t(h({isSigning:!1,errorMessage:""}))},[]),y(()=>{r&&!d&&!E&&t(h({isSigning:!1,errorMessage:""}))},[r]),{onAbort:G,onCancel:o,signMessage:_,sessionId:r||A}};export{ls as a};
//# sourceMappingURL=chunk-ZZ2X3CU4.js.map
